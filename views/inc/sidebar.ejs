<!-- Sidebar Component -->
<aside class="sidebar" id="sidebar">
    <!-- Sidebar Header with Logo -->
    <div class="sidebar-header">
        <div class="sidebar-logo">
            <div class="logo-placeholder">
                <!-- Use provided logo image (place file at public/img/cdte-logo.png) -->
                 <img src="/img/department-logo.png" alt="CDTE Logo" width="48" height="48" class="sidebar-logo-img"
                     onerror="fallbackLogo(this)">
            </div>
            <div class="sidebar-brand">
                <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</h2>
                <p>‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡∏Ñ‡∏£‡∏π</p>
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item <%= currentPage === 'home' ? 'active' : '' %>">
                <a href="/dashboard" class="sidebar-link">
                    <span class="sidebar-icon">üè†</span>
                    <span class="sidebar-text">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
                </a>
            </li>
            <!-- Student links are rendered below only when `isStudentUser` is true -->
            
            <% /* Student-only menu items: visible only when the user has a numeric studentId (real student or admin who also has a studentId) */ %>
            <% const isStudentUser = (user && user.studentId && /^\d+$/.test(String(user.studentId))); %>
            <% if (isStudentUser) { %>
            <li class="sidebar-menu-item <%= currentPage === 'school-info' ? 'active' : '' %>">
                <a href="/dashboard/school-info" class="sidebar-link">
                    <span class="sidebar-icon">üè´</span>
                    <span class="sidebar-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'mentor-info' ? 'active' : '' %>">
                <a href="/dashboard/mentor-info" class="sidebar-link">
                    <span class="sidebar-icon">üë®‚Äçüè´</span>
                    <span class="sidebar-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'evaluation' ? 'active' : '' %>">
                <a href="/dashboard/evaluation" class="sidebar-link">
                    <span class="sidebar-icon">üìù</span>
                    <span class="sidebar-text">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'profile' ? 'active' : '' %>">
                <a href="/dashboard/profile" class="sidebar-link">
                    <span class="sidebar-icon">üë§</span>
                    <span class="sidebar-text">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
                </a>
            </li>
            <% } %>
            
            <!-- Admin Menu Section (visible to teachers and admins only) -->
            <% if (user && (user.role === 'admin' || user.role === 'teacher')) { %>
            <li class="sidebar-menu-divider">
                <span class="sidebar-divider-text">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'admin-observations' ? 'active' : '' %>">
                <a href="/dashboard/admin/observations" class="sidebar-link">
                    <span class="sidebar-icon">üëÅÔ∏è‚Äçüó®Ô∏è</span>
                    <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'admin-users' ? 'active' : '' %>">
                <a href="/dashboard/admin/users" class="sidebar-link">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'admin-system' ? 'active' : '' %>">
                <a href="/dashboard/admin/system" class="sidebar-link">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</span>
                </a>
            </li>
            <li class="sidebar-menu-item <%= currentPage === 'admin-reports' ? 'active' : '' %>">
                <a href="/dashboard/admin/reports" class="sidebar-link">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏</span>
                </a>
            </li>
            <% } %>
        </ul>
    </nav>

    <!-- Sidebar Footer with User Profile -->
    <div class="sidebar-footer">
        <div class="sidebar-user">
            <div class="sidebar-user-avatar">
                <% if (user && user.avatar) { %>
                    <img src="<%= user.avatar %>" alt="Profile">
                    <% } else { %>
                        <div class="avatar-placeholder">
                            <%= user && user.firstName ? user.firstName.charAt(0) : 'U' %>
                        </div>
                        <% } %>
            </div>
            <div class="sidebar-user-info">
                <div class="sidebar-user-name">
                    <%= user ? (user.firstName + ' ' + user.lastName) : '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' %>
                </div>
                <div class="sidebar-user-id">
                    ‡∏£‡∏´‡∏±‡∏™: <%= user ? user.studentId : '-' %>
                </div>
            </div>
        </div>
        <a href="/logout" class="sidebar-logout" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">
            <span>üö™</span>
        </a>
    </div>
</aside>

<!-- Mobile Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Mobile Menu Toggle Button -->
<button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu">
    <span></span>
    <span></span>
    <span></span>
</button>

<script>
    // Fallback: replace missing image with inline SVG logo
    function fallbackLogo(img) {
        const svg = `
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="48" height="48" rx="8" fill="#2E3094" />
            <text x="24" y="32" font-family="Arial" font-size="20" font-weight="bold" fill="white" text-anchor="middle">CDTE</text>
        </svg>`
        img.outerHTML = svg
    }
    // Mobile sidebar toggle
    (function () {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const toggle = document.getElementById('mobileMenuToggle');

        if (toggle && sidebar && overlay) {
            toggle.addEventListener('click', function () {
                sidebar.classList.toggle('sidebar-open');
                overlay.classList.toggle('active');
                document.body.classList.toggle('sidebar-active');
            });

            overlay.addEventListener('click', function () {
                sidebar.classList.remove('sidebar-open');
                overlay.classList.remove('active');
                document.body.classList.remove('sidebar-active');
            });
        }
    })();
</script>