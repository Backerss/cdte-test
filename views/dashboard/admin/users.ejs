<div class="page-content">
  <div class="card">
    <div class="page-header">
      <div>
        <h2 style="margin-top:0;color:var(--color-primary);display:flex;align-items:center;gap:12px">
          <span>üë•</span>
          ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        </h2>
        <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</p>
      </div>
      <button class="btn btn--primary" onclick="openCreateUserModal()">
        <span>‚ûï</span>
        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section"
      style="margin:24px 0;padding:16px;background:var(--color-bg);border-radius:8px;border:1px solid var(--color-border);">
      <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap;">
        <div class="form-group" style="margin:0;flex:1;min-width:200px;">
          <label class="form-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
          <input type="text" class="form-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
            onkeyup="filterUsers()">
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
          <select id="roleFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ (‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤)</label>
          <select id="yearLevelFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="statusFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
            <option value="inactive">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid"
      style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px;">
      <div class="stat-card"
        style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
        <div style="font-size:1.8rem;font-weight:600;color:var(--color-primary);" id="studentCount">0</div>
      </div>
      <div class="stat-card"
        style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë®‚Äçüè´ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</div>
        <div style="font-size:1.8rem;font-weight:600;color:#FF6B35;" id="teacherCount">0</div>
      </div>
      <div class="stat-card"
        style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div style="font-size:1.8rem;font-weight:600;color:#4CAF50;" id="adminCount">0</div>
      </div>
      <div class="stat-card"
        style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë• ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div style="font-size:1.8rem;font-weight:600;color:var(--color-text);" id="totalCount">0</div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="table-container" style="overflow-x:auto;">
      <table class="data-table" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="background:var(--color-bg);border-bottom:2px solid var(--color-border);">
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏£‡∏´‡∏±‡∏™</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Content will be loaded here -->
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div id="paginationContainer"
      style="display:flex;justify-content:space-between;align-items:center;margin-top:24px;padding:16px;background:var(--color-bg);border-radius:8px;">
      <div style="color:var(--color-text);font-size:0.9rem;">
        ‡πÅ‡∏™‡∏î‡∏á <strong id="showingStart">0</strong> - <strong id="showingEnd">0</strong> ‡∏à‡∏≤‡∏Å <strong
          id="totalUsers">0</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </div>
      <div style="display:flex;gap:8px;" id="paginationButtons">
        <!-- Pagination buttons will be generated here -->
      </div>
    </div>
  </div>
</div>

<!-- User Detail Modal -->
<div id="userDetailModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h3 id="userDetailTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
      <button type="button" class="modal-close" onclick="closeUserDetailModal()">√ó</button>
    </div>

    <div class="modal-body" style="padding:24px;">
      <div id="userDetailContent">
        <!-- Content will be loaded here -->
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn--secondary" onclick="closeUserDetailModal()">‡∏õ‡∏¥‡∏î</button>
      <button type="button" class="btn btn--primary" onclick="openEditModalFromDetail()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div id="editUserModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:600px;">
    <div class="modal-header">
      <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
      <button type="button" class="modal-close" onclick="closeEditUserModal()">√ó</button>
    </div>

    <form id="editUserForm">
      <input type="hidden" id="editUserId">
      <div class="modal-body" style="padding:24px;">
        <div class="form-group">
          <label class="form-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó <span class="required">*</span></label>
          <select class="form-input" id="editUserRole" required onchange="toggleEditStudentFields()">
            <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          </select>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ <span class="required">*</span></label>
            <input type="text" class="form-input" id="editUserFirstName" required>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
            <input type="text" class="form-input" id="editUserLastName" required>
          </div>
        </div>

        <div class="form-group" id="editStudentIdGroup">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <span class="required">*</span></label>
          <input type="text" class="form-input" id="editUserStudentId">
        </div>

        <!-- staffCode field removed (not used) -->

        <div class="form-group">
          <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="required">*</span></label>
          <input type="email" class="form-input" id="editUserEmail" required>
        </div>

        <div class="form-group">
          <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input type="text" class="form-input" id="editUserPhone" placeholder="0xxxxxxxxx">
        </div>

        <div class="form-group" id="editYearLevelGroup">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ <span class="required">*</span></label>
          <select class="form-input" id="editUserYearLevel">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
          <small class="form-help" id="editYearLevelHint"></small>
        </div>

        <div class="form-group" id="editMajorGroup">
          <label class="form-label">‡∏™‡∏≤‡∏Ç‡∏≤</label>
          <select class="form-input" id="editUserMajor">
            <option value="">-</option>
            <option value="‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
          </select>
        </div>

        <div class="form-group" id="editRoomGroup">
          <label class="form-label">‡∏´‡πâ‡∏≠‡∏á (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏´‡πâ‡∏≠‡∏á ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ , )</label>
          <input type="text" class="form-input" id="editUserRoom" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 01,02">
        </div>

        <div class="form-group" id="editAcademicPositionGroup" style="display:none;">
          <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</label>
          <input type="text" class="form-input" id="editAcademicPosition">
        </div>

        <div class="form-group">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="required">*</span></label>
          <select class="form-input" id="editUserStatus" required>
            <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
            <option value="inactive">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
          <input type="password" class="form-input" id="editUserPassword" placeholder="‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô">
          <small class="form-help">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</small>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn--danger" onclick="confirmDeleteUser()" style="margin-right:auto;">üóëÔ∏è
          ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
        <button type="button" class="btn btn--secondary" onclick="closeEditUserModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn--primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>
    </form>
  </div>
</div>

<!-- Create User Modal -->
<div id="createUserModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:600px;">
    <div class="modal-header">
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>
      <button type="button" class="modal-close" onclick="closeCreateUserModal()">√ó</button>
    </div>

    <form id="createUserForm">
      <div class="modal-body" style="padding:24px;">
        <div class="form-group">
          <label class="form-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó <span class="required">*</span></label>
          <select class="form-input" id="newUserRole" required onchange="toggleStudentFields()">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</option>
            <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          </select>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ <span class="required">*</span></label>
            <input type="text" class="form-input" id="newUserFirstName" required>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
            <input type="text" class="form-input" id="newUserLastName" required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™ <span class="required">*</span></label>
          <input type="text" class="form-input" id="newUserId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6501001" required>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="required">*</span></label>
          <input type="email" class="form-input" id="newUserEmail" required>
        </div>

        <div class="form-group" id="yearLevelGroup" style="display:none;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ <span class="required">*</span></label>
          <select class="form-input" id="newUserYearLevel">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span class="required">*</span></label>
          <input type="password" class="form-input" id="newUserPassword" required>
          <small class="form-help">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</small>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn--secondary" onclick="closeCreateUserModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn--primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
      </div>
    </form>
  </div>
</div>

<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    gap: 16px;
  }

  .filter-section {
    border: 1px solid var(--color-border);
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
  }

  .data-table tbody tr {
    border-bottom: 1px solid var(--color-border);
    transition: background-color 0.2s ease;
  }

  .data-table tbody tr:hover {
    background: var(--color-bg);
  }

  .role-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .role-badge.student {
    background: #e3f2fd;
    color: #1976d2;
  }

  .role-badge.teacher {
    background: #fff3e0;
    color: #f57c00;
  }

  .role-badge.admin {
    background: #e8f5e9;
    color: #388e3c;
  }

  .status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .status-badge.active {
    background: #e8f5e9;
    color: #2e7d32;
  }

  .status-badge.inactive {
    background: #ffebee;
    color: #c62828;
  }

  .btn--sm {
    padding: 6px 12px;
    font-size: 0.85rem;
  }

  .user-detail-section {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .user-detail-section h4 {
    color: var(--color-primary);
    margin-top: 0;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }

  .info-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .info-label {
    font-size: 0.85rem;
    color: var(--color-muted);
    font-weight: 500;
  }

  .info-value {
    color: var(--color-text);
    font-size: 0.95rem;
  }

  .practice-history-item {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
  }

  .practice-history-item h5 {
    margin: 0 0 12px 0;
    color: var(--color-text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .required {
    color: var(--color-danger);
  }

  .form-help {
    font-size: 0.8rem;
    color: var(--color-muted);
    margin-top: 4px;
    display: block;
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    animation: fadeIn 0.2s ease;
  }

  .modal-content {
    background: var(--color-surface);
    border-radius: 12px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    animation: slideUp 0.3s ease;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 2px solid var(--color-border);
    background: var(--color-bg);
  }

  .modal-header h3 {
    margin: 0;
    color: var(--color-primary);
    font-size: 1.3rem;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 1.8rem;
    cursor: pointer;
    color: var(--color-muted);
    padding: 4px;
    border-radius: 4px;
    transition: all 0.2s ease;
    line-height: 1;
  }

  .modal-close:hover {
    color: var(--color-danger);
    background: rgba(0, 0, 0, 0.05);
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding: 20px 24px;
    border-top: 2px solid var(--color-border);
    background: var(--color-bg);
  }

  /* Ensure SweetAlert overlays built-in modals */
  .swal2-container {
    z-index: 100000 !important;
  }

  .swal2-popup {
    z-index: 100001 !important;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Toast notification system (top-right corner, auto-dismiss)
  function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer') || createToastContainer();

    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.style.cssText = `
    background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#2196F3'};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 300px;
    animation: slideInRight 0.3s ease;
    cursor: pointer;
  `;

    const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
    toast.innerHTML = `
    <span style="font-size: 1.2rem;">${icon}</span>
    <span style="flex: 1;">${message}</span>
  `;

    toastContainer.appendChild(toast);

    // Auto dismiss after 4 seconds
    setTimeout(() => {
      toast.style.animation = 'slideOutRight 0.3s ease';
      setTimeout(() => toast.remove(), 300);
    }, 4000);

    // Click to dismiss
    toast.addEventListener('click', () => {
      toast.style.animation = 'slideOutRight 0.3s ease';
      setTimeout(() => toast.remove(), 300);
    });
  }

  function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.style.cssText = `
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 999999;
    display: flex;
    flex-direction: column;
  `;
    document.body.appendChild(container);

    // Add animations
    const style = document.createElement('style');
    style.textContent = `
    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(400px); opacity: 0; }
    }
  `;
    document.head.appendChild(style);

    return container;
  }

  // Loading indicator
  function showLoading() {
    document.body.style.cursor = 'wait';
  }

  function hideLoading() {
    document.body.style.cursor = 'default';
  }

  // Real data from API
  let currentUsers = [];
  let filteredUsers = [];
  let currentUserForEdit = null;

  // Pagination
  const ITEMS_PER_PAGE = 5;
  let currentPage = 1;
  let totalPages = 1;

  // Initialize page
  document.addEventListener('DOMContentLoaded', function () {
    loadUsers();
  });

  // Fetch users from API
  async function loadUsers() {
    try {
      showLoading();

      const response = await fetch('/api/admin/users');
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
      }

      if (data.success) {
        currentUsers = data.users;
        filteredUsers = [...currentUsers];
        renderUsers();
        updateStats();
      } else {
        showToast(data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
      }
    } catch (error) {
      console.error('Error loading users:', error);
      showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
      // Show empty state
      document.getElementById('usersTableBody').innerHTML = `
      <tr>
        <td colspan="7" style="text-align:center;padding:40px;color:var(--color-muted)">
          <div style="font-size:3rem;margin-bottom:16px">‚ö†Ô∏è</div>
          <div>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
          <button class="btn btn--primary" style="margin-top:16px" onclick="loadUsers()">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </td>
      </tr>
    `;
    } finally {
      hideLoading();
    }
  }

  function renderUsers() {
    const tbody = document.getElementById('usersTableBody');

    if (filteredUsers.length === 0) {
      tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align:center;padding:40px;color:var(--color-muted)">
          <div style="font-size:3rem;margin-bottom:16px">üîç</div>
          <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
        </td>
      </tr>
    `;
      return;
    }

    tbody.innerHTML = filteredUsers.map(user => {
      const displayId = user.user_id || user.studentId || user.id;
      const yearLevel = user.year || user.yearLevel;

      return `
    <tr>
      <td style="padding:12px;">${displayId}</td>
      <td style="padding:12px;">
        <div style="font-weight:500;">${user.firstName} ${user.lastName}</div>
      </td>
      <td style="padding:12px;">${user.email}</td>
      <td style="padding:12px;">
        <span class="role-badge ${user.role}">
          ${getRoleText(user.role)}
        </span>
      </td>
      <td style="padding:12px;text-align:center;">
        ${user.role === 'student' && yearLevel ? `‡∏õ‡∏µ ${yearLevel}` : '-'}
      </td>
      <td style="padding:12px;text-align:center;">
        <span class="status-badge ${user.status || 'active'}">
          ${getStatusText(user.status || 'active')}
        </span>
      </td>
      <td style="padding:12px;text-align:center;">
        <button class="btn btn--secondary btn--sm" onclick='viewUserDetail(${JSON.stringify(user).replace(/'/g, "&#39;")})'>
          üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        </button>
      </td>
    </tr>
  `;
    }).join('');
  }

  function filterUsers() {
    const searchQuery = document.getElementById('searchInput').value.toLowerCase();
    const roleFilter = document.getElementById('roleFilter').value;
    const yearLevelFilter = document.getElementById('yearLevelFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;

    filteredUsers = currentUsers.filter(user => {
      const matchSearch = !searchQuery ||
        (user.firstName || '').toLowerCase().includes(searchQuery) ||
        (user.lastName || '').toLowerCase().includes(searchQuery) ||
        ((user.user_id || user.studentId) || '').toLowerCase().includes(searchQuery) ||
        (user.email || '').toLowerCase().includes(searchQuery);

      const matchRole = !roleFilter || user.role === roleFilter;
      const userYear = user.year || user.yearLevel;
      const matchYearLevel = !yearLevelFilter || userYear?.toString() === yearLevelFilter;
      const matchStatus = !statusFilter || (user.status || 'active') === statusFilter;

      return matchSearch && matchRole && matchYearLevel && matchStatus;
    });

    renderUsers();
    updateStats();
  }

  function updateStats() {
    const students = filteredUsers.filter(u => u.role === 'student').length;
    const teachers = filteredUsers.filter(u => u.role === 'teacher').length;
    const admins = filteredUsers.filter(u => u.role === 'admin').length;

    document.getElementById('studentCount').textContent = students;
    document.getElementById('teacherCount').textContent = teachers;
    document.getElementById('adminCount').textContent = admins;
    document.getElementById('totalCount').textContent = filteredUsers.length;
  }

  async function viewUserDetail(user) {
    try {
      showLoading();

      // Fetch full user detail including practice history
      const response = await fetch(`/api/admin/users/${user.docId || user.id}`);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
      }

      if (!data.success) {
        showToast(data.message || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
        return;
      }

      const fullUser = data.user;

      // Make the fetched fullUser available globally so "Edit from detail" can use it
      window.currentUserForEdit = fullUser;

      document.getElementById('userDetailTitle').textContent = `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${fullUser.firstName} ${fullUser.lastName}`;

      let content = `
      <!-- Basic Info -->
      <div class="user-detail-section">
        <h4>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
        <div class="info-grid">
            <div class="info-item">
              <span class="info-label">‡∏£‡∏´‡∏±‡∏™</span>
              <span class="info-value">${fullUser.user_id || fullUser.studentId || fullUser.id}</span>
            </div>
          <div class="info-item">
            <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
            <span class="info-value">${fullUser.firstName} ${fullUser.lastName}</span>
          </div>
          <div class="info-item">
            <span class="info-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
            <span class="info-value">${fullUser.email}</span>
          </div>
          <div class="info-item">
            <span class="info-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span>
            <span class="info-value">${fullUser.phone || '-'}</span>
          </div>
          <div class="info-item">
            <span class="info-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</span>
            <span class="info-value">
              <span class="role-badge ${fullUser.role}">${getRoleText(fullUser.role)}</span>
            </span>
          </div>
          ${fullUser.year ? `
            <div class="info-item">
              <span class="info-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</span>
              <span class="info-value">‡∏õ‡∏µ ${fullUser.year}</span>
            </div>
          ` : ''}
          <div class="info-item">
            <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
            <span class="info-value">
              <span class="status-badge ${fullUser.status}">${getStatusText(fullUser.status)}</span>
            </span>
          </div>
        </div>
      </div>
    `;

      // For students, show practice history
      if (fullUser.role === 'student' && fullUser.practiceHistory && fullUser.practiceHistory.length > 0) {
        content += `
      <div class="user-detail-section">
        <h4>üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</h4>
        ${fullUser.practiceHistory.map(practice => `
          <div class="practice-history-item">
            <h5>üè´ ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${practice.year}</h5>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                <span class="info-value">${practice.school}</span>
              </div>
              <div class="info-item">
                <span class="info-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
                <span class="info-value">${practice.period}</span>
              </div>
            </div>
            
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--color-border);">
              <h6 style="margin:0 0 12px 0;color:var(--color-text);font-size:0.95rem;">üë®‚Äçüè´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h6>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠</span>
                  <span class="info-value">${practice.mentor.name}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span>
                  <span class="info-value">${practice.mentor.phone}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                  <span class="info-value">${practice.mentor.email}</span>
                </div>
              </div>
            </div>

            <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--color-border);">
              <h6 style="margin:0 0 12px 0;color:var(--color-text);font-size:0.95rem;">üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h6>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
                  <span class="info-value">${practice.evaluationsCompleted}/9 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</span>
                  <span class="info-value">
                    ${practice.lessonPlanSubmitted ?
            '<span style="color:#2e7d32;">‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>' :
            '<span style="color:#c62828;">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á</span>'
          }
                  </span>
                </div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
      }

      // For teachers/admins, show additional info
      if (fullUser.role === 'teacher' || fullUser.role === 'admin') {
        content += `
      <div class="user-detail-section">
        <h4>üè¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h4>
        <div class="info-grid">
          ${fullUser.department ? `
            <div class="info-item">
              <span class="info-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</span>
              <span class="info-value">${fullUser.department}</span>
            </div>
          ` : ''}
          ${fullUser.expertise ? `
            <div class="info-item">
              <span class="info-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</span>
              <span class="info-value">${fullUser.expertise}</span>
            </div>
          ` : ''}
        </div>
      </div>
    `;
      }

      document.getElementById('userDetailContent').innerHTML = content;
      document.getElementById('userDetailModal').style.display = 'flex';
    } catch (error) {
      console.error('Error loading user detail:', error);
      showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
    } finally {
      hideLoading();
    }
  }

  function closeUserDetailModal() {
    document.getElementById('userDetailModal').style.display = 'none';
  }

  function openCreateUserModal() {
    document.getElementById('createUserModal').style.display = 'flex';
  }

  function closeCreateUserModal() {
    document.getElementById('createUserModal').style.display = 'none';
    document.getElementById('createUserForm').reset();
    document.getElementById('yearLevelGroup').style.display = 'none';
  }

  function toggleStudentFields() {
    const role = document.getElementById('newUserRole').value;
    const yearLevelGroup = document.getElementById('yearLevelGroup');

    if (role === 'student') {
      yearLevelGroup.style.display = 'block';
      document.getElementById('newUserYearLevel').required = true;
      // For students, clear auto-generated id placeholder
      const idInput = document.getElementById('newUserId');
      if (idInput) {
        idInput.placeholder = '‡πÄ‡∏ä‡πà‡∏ô 65010010001 (‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 11 ‡∏´‡∏•‡∏±‡∏Å)';
      }
    } else {
      yearLevelGroup.style.display = 'none';
      document.getElementById('newUserYearLevel').required = false;
      // For teacher/admin, prefill an auto-generated staff code (Thai year suffix + random digits)
      const idInput = document.getElementById('newUserId');
      if (idInput) {
        idInput.placeholder = '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ)';
        // Only fill if empty to avoid overwriting manual edits
        if (!idInput.value) {
          idInput.value = generateStaffCode();
        }
      }
    }
  }

  // Generate staffCode: Thai year two-digit suffix + 9 random digits => total 11 chars
  function generateStaffCode() {
    const thaiYearSuffix = String((new Date().getFullYear() + 543) % 100).padStart(2, '0');
    const rand = Math.floor(Math.random() * 1e9).toString().padStart(9, '0');
    return thaiYearSuffix + rand;
  }

  // Form submission
  document.getElementById('createUserForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const role = document.getElementById('newUserRole').value;
    const userId = document.getElementById('newUserId').value;

    const formData = {
      firstName: document.getElementById('newUserFirstName').value,
      lastName: document.getElementById('newUserLastName').value,
      email: document.getElementById('newUserEmail').value,
      role: role,
      password: document.getElementById('newUserPassword').value,
      user_id: userId // always send user_id for all roles
    };

    // Add role-specific fields
    if (role === 'student') {
      formData.yearLevel = document.getElementById('newUserYearLevel').value;
    }

    try {
      showLoading();

      const response = await fetch('/api/admin/users', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
      }

      if (data.success) {
        showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${formData.firstName} ${formData.lastName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
        closeCreateUserModal();
        // Reload users list
        await loadUsers();
      } else {
        showToast(data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ', 'error');
      }
    } catch (error) {
      console.error('Error creating user:', error);
      showToast(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
    } finally {
      hideLoading();
    }
  });

  // Helper functions
  function getRoleText(role) {
    const roleMap = {
      student: 'üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
      teacher: 'üë®‚Äçüè´ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå',
      admin: '‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö'
    };
    return roleMap[role] || role;
  }

  function getStatusText(status) {
    const statusMap = {
      active: '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà',
      inactive: '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
    };
    return statusMap[status] || status;
  }

  // Close modals when clicking outside
  document.getElementById('userDetailModal').addEventListener('click', function (e) {
    if (e.target === this) {
      closeUserDetailModal();
    }
  });

  document.getElementById('createUserModal').addEventListener('click', function (e) {
    if (e.target === this) {
      closeCreateUserModal();
    }
  });
</script>

<!-- Enhanced features: pagination & edit -->
<script src="/js/admin-users-enhanced.js"></script>