<div class="page-content">
  <div class="card">
    <div class="page-header">
      <div>
        <h2 style="margin-top:0;color:var(--color-primary);display:flex;align-items:center;gap:12px">
          <span>üë•</span>
          ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        </h2>
        <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</p>
      </div>
      <button class="btn btn--primary" onclick="openCreateUserModal()">
        <span>‚ûï</span>
        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section" style="margin:24px 0;padding:16px;background:var(--color-bg);border-radius:8px;border:1px solid var(--color-border);">
      <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap;">
        <div class="form-group" style="margin:0;flex:1;min-width:200px;">
          <label class="form-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
          <input type="text" class="form-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•" onkeyup="filterUsers()">
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
          <select id="roleFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ (‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤)</label>
          <select id="yearLevelFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:140px;">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="statusFilter" class="form-input" onchange="filterUsers()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
            <option value="inactive">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px;">
      <div class="stat-card" style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
        <div style="font-size:1.8rem;font-weight:600;color:var(--color-primary);" id="studentCount">0</div>
      </div>
      <div class="stat-card" style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë®‚Äçüè´ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</div>
        <div style="font-size:1.8rem;font-weight:600;color:#FF6B35;" id="teacherCount">0</div>
      </div>
      <div class="stat-card" style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div style="font-size:1.8rem;font-weight:600;color:#4CAF50;" id="adminCount">0</div>
      </div>
      <div class="stat-card" style="background:var(--color-surface);border:1px solid var(--color-border);border-radius:8px;padding:16px;">
        <div style="font-size:0.85rem;color:var(--color-muted);margin-bottom:8px;">üë• ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div style="font-size:1.8rem;font-weight:600;color:var(--color-text);" id="totalCount">0</div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="table-container" style="overflow-x:auto;">
      <table class="data-table" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="background:var(--color-bg);border-bottom:2px solid var(--color-border);">
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏£‡∏´‡∏±‡∏™</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th style="padding:12px;text-align:left;font-weight:600;">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th style="padding:12px;text-align:center;font-weight:600;">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Content will be loaded here -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- User Detail Modal -->
<div id="userDetailModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h3 id="userDetailTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
      <button type="button" class="modal-close" onclick="closeUserDetailModal()">√ó</button>
    </div>
    
    <div class="modal-body" style="padding:24px;">
      <div id="userDetailContent">
        <!-- Content will be loaded here -->
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn--secondary" onclick="closeUserDetailModal()">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<!-- Create User Modal -->
<div id="createUserModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:600px;">
    <div class="modal-header">
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>
      <button type="button" class="modal-close" onclick="closeCreateUserModal()">√ó</button>
    </div>
    
    <form id="createUserForm">
      <div class="modal-body" style="padding:24px;">
        <div class="form-group">
          <label class="form-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó <span class="required">*</span></label>
          <select class="form-input" id="newUserRole" required onchange="toggleStudentFields()">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</option>
            <option value="student">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
          </select>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ <span class="required">*</span></label>
            <input type="text" class="form-input" id="newUserFirstName" required>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
            <input type="text" class="form-input" id="newUserLastName" required>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™ <span class="required">*</span></label>
          <input type="text" class="form-input" id="newUserId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6501001" required>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="required">*</span></label>
          <input type="email" class="form-input" id="newUserEmail" required>
        </div>

        <div class="form-group" id="yearLevelGroup" style="display:none;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ <span class="required">*</span></label>
          <select class="form-input" id="newUserYearLevel">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span class="required">*</span></label>
          <input type="password" class="form-input" id="newUserPassword" required>
          <small class="form-help">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</small>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn--secondary" onclick="closeCreateUserModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn--primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
      </div>
    </form>
  </div>
</div>

<style>
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
  gap: 16px;
}

.filter-section {
  border: 1px solid var(--color-border);
}

.data-table {
  width: 100%;
  border-collapse: collapse;
}

.data-table tbody tr {
  border-bottom: 1px solid var(--color-border);
  transition: background-color 0.2s ease;
}

.data-table tbody tr:hover {
  background: var(--color-bg);
}

.role-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
}

.role-badge.student {
  background: #e3f2fd;
  color: #1976d2;
}

.role-badge.teacher {
  background: #fff3e0;
  color: #f57c00;
}

.role-badge.admin {
  background: #e8f5e9;
  color: #388e3c;
}

.status-badge {
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
}

.status-badge.active {
  background: #e8f5e9;
  color: #2e7d32;
}

.status-badge.inactive {
  background: #ffebee;
  color: #c62828;
}

.btn--sm {
  padding: 6px 12px;
  font-size: 0.85rem;
}

.user-detail-section {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.user-detail-section h4 {
  color: var(--color-primary);
  margin-top: 0;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.info-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.info-label {
  font-size: 0.85rem;
  color: var(--color-muted);
  font-weight: 500;
}

.info-value {
  color: var(--color-text);
  font-size: 0.95rem;
}

.practice-history-item {
  background: white;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
}

.practice-history-item h5 {
  margin: 0 0 12px 0;
  color: var(--color-text);
  display: flex;
  align-items: center;
  gap: 8px;
}

.required {
  color: var(--color-danger);
}

.form-help {
  font-size: 0.8rem;
  color: var(--color-muted);
  margin-top: 4px;
  display: block;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  animation: fadeIn 0.2s ease;
}

.modal-content {
  background: var(--color-surface);
  border-radius: 12px;
  width: 95%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.3s ease;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 2px solid var(--color-border);
  background: var(--color-bg);
}

.modal-header h3 {
  margin: 0;
  color: var(--color-primary);
  font-size: 1.3rem;
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: var(--color-muted);
  padding: 4px;
  border-radius: 4px;
  transition: all 0.2s ease;
  line-height: 1;
}

.modal-close:hover {
  color: var(--color-danger);
  background: rgba(0, 0, 0, 0.05);
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 20px 24px;
  border-top: 2px solid var(--color-border);
  background: var(--color-bg);
}

/* Ensure SweetAlert overlays built-in modals */
.swal2-container {
  z-index: 100000 !important;
}
.swal2-popup {
  z-index: 100001 !important;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// Mock data - replace with real API calls
const mockUsers = [
  {
    id: '6501001',
    firstName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢',
    lastName: '‡πÉ‡∏à‡∏î‡∏µ',
    email: 'somchai.j@email.com',
    role: 'student',
    yearLevel: 2,
    status: 'active',
    practiceHistory: [
      {
        year: '2567',
        school: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏£‡∏≤‡∏ä‡∏†‡∏±‡∏è‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå',
        mentor: {
          name: '‡∏≠‡∏£‡∏∏‡∏ì ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤',
          phone: '081-234-5678',
          email: 'arun.w@school.ac.th'
        },
        period: '1 ‡∏û.‡∏¢. 2567 - 15 ‡∏û.‡∏¢. 2567',
        evaluationsCompleted: 9,
        lessonPlanSubmitted: true
      },
      {
        year: '2566',
        school: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏• 1',
        mentor: {
          name: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
          phone: '082-345-6789',
          email: 'somying.r@school.ac.th'
        },
        period: '1 ‡∏û.‡∏¢. 2566 - 15 ‡∏û.‡∏¢. 2566',
        evaluationsCompleted: 9,
        lessonPlanSubmitted: true
      }
    ]
  },
  {
    id: '6501002',
    firstName: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á',
    lastName: '‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
    email: 'somying.r@email.com',
    role: 'student',
    yearLevel: 2,
    status: 'active',
    practiceHistory: [
      {
        year: '2567',
        school: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏• 2',
        mentor: {
          name: '‡∏ß‡∏£‡∏£‡∏ì‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™',
          phone: '083-456-7890',
          email: 'wanna.s@school.ac.th'
        },
        period: '1 ‡∏û.‡∏¢. 2567 - 15 ‡∏û.‡∏¢. 2567',
        evaluationsCompleted: 6,
        lessonPlanSubmitted: false
      }
    ]
  },
  {
    id: 'T001',
    firstName: '‡∏î‡∏£.‡∏°‡∏≤‡∏ô‡∏∞',
    lastName: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£',
    email: 'mana.w@nsru.ac.th',
    role: 'teacher',
    status: 'active',
    department: '‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô',
    expertise: '‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•, ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤'
  },
  {
    id: 'T002',
    firstName: '‡∏ú‡∏®.‡∏î‡∏£.‡∏õ‡∏£‡∏µ‡∏¢‡∏≤',
    lastName: '‡∏â‡∏•‡∏≤‡∏î‡∏Å‡∏≤‡∏£',
    email: 'priya.c@nsru.ac.th',
    role: 'teacher',
    status: 'active',
    department: '‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢',
    expertise: '‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ, ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏î‡πá‡∏Å‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢'
  },
  {
    id: 'A001',
    firstName: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏ç',
    lastName: '‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
    email: 'wichan.d@nsru.ac.th',
    role: 'admin',
    status: 'active',
    department: '‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®'
  }
];

let currentUsers = [];
let filteredUsers = [];

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  loadUsers();
  updateStats();
});

function loadUsers() {
  currentUsers = [...mockUsers];
  filteredUsers = [...currentUsers];
  renderUsers();
}

function renderUsers() {
  const tbody = document.getElementById('usersTableBody');
  
  if (filteredUsers.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align:center;padding:40px;color:var(--color-muted)">
          <div style="font-size:3rem;margin-bottom:16px">üîç</div>
          <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
        </td>
      </tr>
    `;
    return;
  }

  tbody.innerHTML = filteredUsers.map(user => `
    <tr>
      <td style="padding:12px;">${user.id}</td>
      <td style="padding:12px;">
        <div style="font-weight:500;">${user.firstName} ${user.lastName}</div>
      </td>
      <td style="padding:12px;">${user.email}</td>
      <td style="padding:12px;">
        <span class="role-badge ${user.role}">
          ${getRoleText(user.role)}
        </span>
      </td>
      <td style="padding:12px;text-align:center;">
        ${user.role === 'student' ? `‡∏õ‡∏µ ${user.yearLevel}` : '-'}
      </td>
      <td style="padding:12px;text-align:center;">
        <span class="status-badge ${user.status}">
          ${getStatusText(user.status)}
        </span>
      </td>
      <td style="padding:12px;text-align:center;">
        <button class="btn btn--secondary btn--sm" onclick='viewUserDetail(${JSON.stringify(user).replace(/'/g, "&#39;")})'>
          üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        </button>
      </td>
    </tr>
  `).join('');
}

function filterUsers() {
  const searchQuery = document.getElementById('searchInput').value.toLowerCase();
  const roleFilter = document.getElementById('roleFilter').value;
  const yearLevelFilter = document.getElementById('yearLevelFilter').value;
  const statusFilter = document.getElementById('statusFilter').value;

  filteredUsers = currentUsers.filter(user => {
    const matchSearch = !searchQuery || 
      user.firstName.toLowerCase().includes(searchQuery) ||
      user.lastName.toLowerCase().includes(searchQuery) ||
      user.id.toLowerCase().includes(searchQuery) ||
      user.email.toLowerCase().includes(searchQuery);
    
    const matchRole = !roleFilter || user.role === roleFilter;
    const matchYearLevel = !yearLevelFilter || user.yearLevel?.toString() === yearLevelFilter;
    const matchStatus = !statusFilter || user.status === statusFilter;

    return matchSearch && matchRole && matchYearLevel && matchStatus;
  });

  renderUsers();
  updateStats();
}

function updateStats() {
  const students = filteredUsers.filter(u => u.role === 'student').length;
  const teachers = filteredUsers.filter(u => u.role === 'teacher').length;
  const admins = filteredUsers.filter(u => u.role === 'admin').length;
  
  document.getElementById('studentCount').textContent = students;
  document.getElementById('teacherCount').textContent = teachers;
  document.getElementById('adminCount').textContent = admins;
  document.getElementById('totalCount').textContent = filteredUsers.length;
}

function viewUserDetail(user) {
  document.getElementById('userDetailTitle').textContent = `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${user.firstName} ${user.lastName}`;
  
  let content = `
    <!-- Basic Info -->
    <div class="user-detail-section">
      <h4>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">‡∏£‡∏´‡∏±‡∏™</span>
          <span class="info-value">${user.id}</span>
        </div>
        <div class="info-item">
          <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
          <span class="info-value">${user.firstName} ${user.lastName}</span>
        </div>
        <div class="info-item">
          <span class="info-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
          <span class="info-value">${user.email}</span>
        </div>
        <div class="info-item">
          <span class="info-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</span>
          <span class="info-value">
            <span class="role-badge ${user.role}">${getRoleText(user.role)}</span>
          </span>
        </div>
        ${user.yearLevel ? `
          <div class="info-item">
            <span class="info-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</span>
            <span class="info-value">‡∏õ‡∏µ ${user.yearLevel}</span>
          </div>
        ` : ''}
        <div class="info-item">
          <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
          <span class="info-value">
            <span class="status-badge ${user.status}">${getStatusText(user.status)}</span>
          </span>
        </div>
      </div>
    </div>
  `;

  // For students, show practice history
  if (user.role === 'student' && user.practiceHistory && user.practiceHistory.length > 0) {
    content += `
      <div class="user-detail-section">
        <h4>üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</h4>
        ${user.practiceHistory.map(practice => `
          <div class="practice-history-item">
            <h5>üè´ ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${practice.year}</h5>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                <span class="info-value">${practice.school}</span>
              </div>
              <div class="info-item">
                <span class="info-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
                <span class="info-value">${practice.period}</span>
              </div>
            </div>
            
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--color-border);">
              <h6 style="margin:0 0 12px 0;color:var(--color-text);font-size:0.95rem;">üë®‚Äçüè´ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏û‡∏µ‡πà‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h6>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠</span>
                  <span class="info-value">${practice.mentor.name}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span>
                  <span class="info-value">${practice.mentor.phone}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                  <span class="info-value">${practice.mentor.email}</span>
                </div>
              </div>
            </div>

            <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--color-border);">
              <h6 style="margin:0 0 12px 0;color:var(--color-text);font-size:0.95rem;">üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h6>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
                  <span class="info-value">${practice.evaluationsCompleted}/9 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                </div>
                <div class="info-item">
                  <span class="info-label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</span>
                  <span class="info-value">
                    ${practice.lessonPlanSubmitted ? 
                      '<span style="color:#2e7d32;">‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>' : 
                      '<span style="color:#c62828;">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á</span>'
                    }
                  </span>
                </div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  // For teachers/admins, show additional info
  if (user.role === 'teacher' || user.role === 'admin') {
    content += `
      <div class="user-detail-section">
        <h4>üè¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h4>
        <div class="info-grid">
          ${user.department ? `
            <div class="info-item">
              <span class="info-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</span>
              <span class="info-value">${user.department}</span>
            </div>
          ` : ''}
          ${user.expertise ? `
            <div class="info-item">
              <span class="info-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</span>
              <span class="info-value">${user.expertise}</span>
            </div>
          ` : ''}
        </div>
      </div>
    `;
  }

  document.getElementById('userDetailContent').innerHTML = content;
  document.getElementById('userDetailModal').style.display = 'flex';
}

function closeUserDetailModal() {
  document.getElementById('userDetailModal').style.display = 'none';
}

function openCreateUserModal() {
  document.getElementById('createUserModal').style.display = 'flex';
}

function closeCreateUserModal() {
  document.getElementById('createUserModal').style.display = 'none';
  document.getElementById('createUserForm').reset();
  document.getElementById('yearLevelGroup').style.display = 'none';
}

function toggleStudentFields() {
  const role = document.getElementById('newUserRole').value;
  const yearLevelGroup = document.getElementById('yearLevelGroup');
  
  if (role === 'student') {
    yearLevelGroup.style.display = 'block';
    document.getElementById('newUserYearLevel').required = true;
  } else {
    yearLevelGroup.style.display = 'none';
    document.getElementById('newUserYearLevel').required = false;
  }
}

// Form submission
document.getElementById('createUserForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = {
    id: document.getElementById('newUserId').value,
    firstName: document.getElementById('newUserFirstName').value,
    lastName: document.getElementById('newUserLastName').value,
    email: document.getElementById('newUserEmail').value,
    role: document.getElementById('newUserRole').value,
    yearLevel: document.getElementById('newUserYearLevel').value || null,
    password: document.getElementById('newUserPassword').value,
    status: 'active',
    practiceHistory: []
  };

  // Check if user ID already exists
  if (mockUsers.some(u => u.id === formData.id)) {
    Swal.fire({
      icon: 'error',
      title: '‡∏£‡∏´‡∏±‡∏™‡∏ã‡πâ‡∏≥',
      text: '‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∑‡πà‡∏ô'
    });
    return;
  }

  // Add to mock data
  mockUsers.push(formData);
  
  Swal.fire({
    icon: 'success',
    title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    text: `‡πÄ‡∏û‡∏¥‡πà‡∏° ${formData.firstName} ${formData.lastName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß`
  });

  closeCreateUserModal();
  loadUsers();
});

// Helper functions
function getRoleText(role) {
  const roleMap = {
    student: 'üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
    teacher: 'üë®‚Äçüè´ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå',
    admin: '‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö'
  };
  return roleMap[role] || role;
}

function getStatusText(status) {
  const statusMap = {
    active: '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà',
    inactive: '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'
  };
  return statusMap[status] || status;
}

// Close modals when clicking outside
document.getElementById('userDetailModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeUserDetailModal();
  }
});

document.getElementById('createUserModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeCreateUserModal();
  }
});
</script>