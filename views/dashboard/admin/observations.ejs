<!-- External CSS -->
<link rel="stylesheet" href="/css/observations.css">

<div class="page-content">
  <div class="card">
    <div class="page-header">
      <div>
        <h2 style="margin-top:0;color:var(--color-primary);display:flex;align-items:center;gap:12px">
          <span>üëÅÔ∏è‚Äçüó®Ô∏è</span>
          ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏
        </h2>
        <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
      </div>
      <button class="btn btn--primary" onclick="openCreateObservationModal()">
        <span>‚ûï</span>
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section" style="margin:24px 0;padding:16px;background:var(--color-bg);border-radius:8px;">
      <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap;">
        <div class="form-group" style="margin:0;min-width:120px;">
          <label class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <select id="academicYearFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="2567">2567</option>
            <option value="2566">2566</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:100px;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
          <select id="yearLevelFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:120px;">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="statusFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="active">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Observations List -->
    <div id="observationsList">
      <!-- Content will be loaded here -->
    </div>
  </div>
</div>

<!-- Create Observation Modal -->
<div id="createObservationModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:700px;">
    <div class="modal-header">
      <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà</h3>
      <button type="button" class="modal-close" onclick="closeCreateObservationModal()">√ó</button>
    </div>
    
    <form id="createObservationForm">
      <div class="modal-body" style="padding:24px;">
        <div class="form-group">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏ <span class="required">*</span></label>
          <input type="text" class="form-input" id="observationName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô ‡∏õ‡∏µ 2 ‡πÄ‡∏ó‡∏≠‡∏° 1/2567" required>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <span class="required">*</span></label>
            <select class="form-input" id="academicYear" onchange="checkYearConflict()" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
              <option value="2567">2567</option>
              <option value="2568">2568</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ <span class="required">*</span></label>
            <select class="form-input" id="yearLevel" onchange="checkYearConflict()" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
              <option value="1">‡∏õ‡∏µ 1</option>
              <option value="2">‡∏õ‡∏µ 2</option>
              <option value="3">‡∏õ‡∏µ 3</option>
              <option value="4">‡∏õ‡∏µ 4</option>
            </select>
          </div>
        </div>

        <div id="yearConflictWarning" class="alert alert--danger" style="display:none;">
          <strong>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏≠‡∏∑‡πà‡∏ô
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <span class="required">*</span></label>
            <input type="date" class="form-input" id="startDate" onchange="calculateEndDate()" required>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
            <input type="date" class="form-input" id="endDate" style="background:#f5f5f5;">
            <small class="form-help">‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (15 ‡∏ß‡∏±‡∏ô)</small>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
          <textarea class="form-input" id="description" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏"></textarea>
        </div>

        <!-- Student Selection -->
        <div class="form-group">
          <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <div class="student-selection">
            <!-- Filter Section -->
            <div style="display:grid;grid-template-columns:1fr 1fr 2fr;gap:12px;margin-bottom:12px;">
              <select class="form-input" id="studentYearFilter" onchange="filterStudentsList()">
                <option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
                <option value="1">‡∏õ‡∏µ 1</option>
                <option value="2">‡∏õ‡∏µ 2</option>
                <option value="3">‡∏õ‡∏µ 3</option>
                <option value="4">‡∏õ‡∏µ 4</option>
              </select>
              <select class="form-input" id="studentPrefixFilter" onchange="filterStudentsList()">
                <option value="">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <!-- Options will be populated dynamically -->
              </select>
              <input type="text" class="form-input" id="studentSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)" onkeyup="filterStudentsList()">
            </div>
            
            <!-- Action Buttons -->
            <div style="display:flex;gap:8px;margin-bottom:12px;">
              <button type="button" class="btn btn--secondary btn--sm" onclick="selectAllVisibleStudents()">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á</button>
              <button type="button" class="btn btn--secondary btn--sm" onclick="clearAllStudents()">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
              <span style="margin-left:auto;font-size:0.85rem;color:var(--color-muted);align-self:center;" id="selectedCount">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: 0 ‡∏Ñ‡∏ô</span>
            </div>
            
            <div id="studentsList" class="students-list">
              <!-- Students will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn--secondary" onclick="closeCreateObservationModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn--primary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏</button>
      </div>
    </form>
  </div>
</div>

<!-- Student Management Modal -->
<div id="studentManagementModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h3 id="managementModalTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
      <button type="button" class="modal-close" onclick="closeStudentManagementModal()">√ó</button>
    </div>
    
    <div class="modal-body" style="padding:24px;">
      <div id="studentManagementContent">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Pass user data to JavaScript -->
<script>
  window.currentUser = {
    role: '<%= user.role %>'
  };
</script>

<!-- External JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/observations.js"></script>
<script src="/js/school-info.js"></script>