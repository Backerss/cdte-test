<div class="page-content">
  <div class="card">
    <div class="page-header">
      <div>
        <h2 style="margin-top:0;color:var(--color-primary);display:flex;align-items:center;gap:12px">
          <span>üëÅÔ∏è‚Äçüó®Ô∏è</span>
          ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏
        </h2>
        <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
      </div>
      <button class="btn btn--primary" onclick="openCreateObservationModal()">
        <span>‚ûï</span>
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <!-- Filter Section -->
    <div class="filter-section" style="margin:24px 0;padding:16px;background:var(--color-bg);border-radius:8px;">
      <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap;">
        <div class="form-group" style="margin:0;min-width:120px;">
          <label class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <select id="academicYearFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="2567" selected>2567</option>
            <option value="2566">2566</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:100px;">
          <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
          <select id="yearLevelFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="1">‡∏õ‡∏µ 1</option>
            <option value="2">‡∏õ‡∏µ 2</option>
            <option value="3">‡∏õ‡∏µ 3</option>
            <option value="4">‡∏õ‡∏µ 4</option>
          </select>
        </div>
        <div class="form-group" style="margin:0;min-width:120px;">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="statusFilter" class="form-input" onchange="filterObservations()">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="active">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Observations List -->
    <div id="observationsList">
      <!-- Content will be loaded here -->
    </div>
  </div>
</div>

<!-- Create Observation Modal -->
<div id="createObservationModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:700px;">
    <div class="modal-header">
      <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà</h3>
      <button type="button" class="modal-close" onclick="closeCreateObservationModal()">√ó</button>
    </div>
    
    <form id="createObservationForm">
      <div class="modal-body" style="padding:24px;">
        <div class="form-group">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏ <span class="required">*</span></label>
          <input type="text" class="form-input" id="observationName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô ‡∏õ‡∏µ 2 ‡πÄ‡∏ó‡∏≠‡∏° 1/2567" required>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <span class="required">*</span></label>
            <select class="form-input" id="academicYear" onchange="checkYearConflict()" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
              <option value="2567">2567</option>
              <option value="2568">2568</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ <span class="required">*</span></label>
            <select class="form-input" id="yearLevel" onchange="checkYearConflict()" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
              <option value="1">‡∏õ‡∏µ 1</option>
              <option value="2">‡∏õ‡∏µ 2</option>
              <option value="3">‡∏õ‡∏µ 3</option>
              <option value="4">‡∏õ‡∏µ 4</option>
            </select>
          </div>
        </div>

        <div id="yearConflictWarning" class="alert alert--danger" style="display:none;">
          <strong>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏≠‡∏∑‡πà‡∏ô
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="form-group">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <span class="required">*</span></label>
            <input type="date" class="form-input" id="startDate" onchange="calculateEndDate()" required>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
            <input type="date" class="form-input" id="endDate" readonly style="background:#f5f5f5;">
            <small class="form-help">‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (15 ‡∏ß‡∏±‡∏ô)</small>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
          <textarea class="form-input" id="description" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏"></textarea>
        </div>

        <!-- Student Selection -->
        <div class="form-group">
          <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <div class="student-selection">
            <div class="search-section">
              <input type="text" class="form-input" id="studentSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)" onkeyup="searchStudents()">
              <button type="button" class="btn btn--secondary" onclick="selectAllStudents()">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
            <div id="studentsList" class="students-list">
              <!-- Students will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn--secondary" onclick="closeCreateObservationModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="btn btn--primary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏</button>
      </div>
    </form>
  </div>
</div>

<!-- Student Management Modal -->
<div id="studentManagementModal" class="modal-overlay" style="display:none">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h3 id="managementModalTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
      <button type="button" class="modal-close" onclick="closeStudentManagementModal()">√ó</button>
    </div>
    
    <div class="modal-body" style="padding:24px;">
      <div id="studentManagementContent">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>
</div>

<style>
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
  gap: 16px;
}

.filter-section {
  border: 1px solid var(--color-border);
}

.observation-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 16px;
  transition: box-shadow 0.2s ease;
}

.observation-card:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.observation-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.observation-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0;
}

.observation-meta {
  display: flex;
  gap: 16px;
  font-size: 0.9rem;
  color: var(--color-muted);
  margin-bottom: 12px;
}

.status-badge {
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 500;
}

.status-badge.active {
  background: #e3f2fd;
  color: #1976d2;
}

.status-badge.completed {
  background: #e8f5e8;
  color: #2e7d32;
}

.status-badge.cancelled {
  background: #ffebee;
  color: #c62828;
}

.progress-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin: 16px 0;
}

.progress-item {
  background: var(--color-bg);
  padding: 12px;
  border-radius: 6px;
  text-align: center;
}

.progress-number {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--color-primary);
}

.progress-label {
  font-size: 0.85rem;
  color: var(--color-muted);
}

.observation-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.btn--sm {
  padding: 6px 12px;
  font-size: 0.85rem;
}

.student-selection {
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 16px;
  background: var(--color-bg);
}

.search-section {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}

.search-section input {
  flex: 1;
}

.students-list {
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  background: white;
}

.student-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-bottom: 1px solid var(--color-border);
  transition: background-color 0.2s ease;
}

.student-item:last-child {
  border-bottom: none;
}

.student-item:hover {
  background: var(--color-bg);
}

.student-checkbox {
  width: 16px;
  height: 16px;
}

.student-info {
  flex: 1;
}

.student-name {
  font-weight: 500;
  color: var(--color-text);
}

.student-id {
  font-size: 0.85rem;
  color: var(--color-muted);
}

.alert {
  padding: 12px;
  border-radius: 6px;
  margin: 16px 0;
}

.alert--danger {
  background: #ffebee;
  color: #c62828;
  border: 1px solid #ffcdd2;
}

.required {
  color: var(--color-danger);
}

.form-help {
  font-size: 0.8rem;
  color: var(--color-muted);
  margin-top: 4px;
  display: block;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  animation: fadeIn 0.2s ease;
}

.modal-content {
  background: var(--color-surface);
  border-radius: 12px;
  width: 95%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.3s ease;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 2px solid var(--color-border);
  background: var(--color-bg);
}

.modal-header h3 {
  margin: 0;
  color: var(--color-primary);
  font-size: 1.3rem;
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: var(--color-muted);
  padding: 4px;
  border-radius: 4px;
  transition: all 0.2s ease;
  line-height: 1;
}

.modal-close:hover {
  color: var(--color-danger);
  background: rgba(0, 0, 0, 0.05);
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 20px 24px;
  border-top: 2px solid var(--color-border);
  background: var(--color-bg);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
/* Ensure SweetAlert overlays built-in modals (modals use z-index:2000) */
.swal2-container {
  z-index: 100000 !important;
}
.swal2-popup {
  z-index: 100001 !important;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// Mock data - replace with real API calls
const mockObservations = [
  {
    id: 1,
    name: '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô ‡∏õ‡∏µ 2 ‡πÄ‡∏ó‡∏≠‡∏° 1/2567',
    academicYear: '2567',
    yearLevel: 2,
    startDate: '2024-11-01',
    endDate: '2024-11-15',
    status: 'active',
    description: '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2',
    totalStudents: 25,
    completedEvaluations: 18,
    submittedLessonPlans: 22,
    students: [
      { id: '6501001', name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', status: 'active', evaluationsCompleted: 6, lessonPlanSubmitted: true },
      { id: '6501002', name: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', status: 'active', evaluationsCompleted: 9, lessonPlanSubmitted: true },
      { id: '6501003', name: '‡∏ò‡∏ô‡∏≤‡∏Å‡∏£ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', status: 'terminated', evaluationsCompleted: 3, lessonPlanSubmitted: false }
    ]
  }
];

const mockStudents = [
  { id: '6701001', name: '‡∏≠‡∏£‡∏∏‡∏ì ‡πÉ‡∏à‡∏î‡∏µ', yearLevel: 1 },
  { id: '6701002', name: '‡∏ß‡∏£‡∏£‡∏ì‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™', yearLevel: 1 },
  { id: '6601001', name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', yearLevel: 2 },
  { id: '6601002', name: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', yearLevel: 2 },
  { id: '6601003', name: '‡∏ò‡∏ô‡∏≤‡∏Å‡∏£ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', yearLevel: 2 },
  { id: '6501001', name: '‡∏°‡∏≤‡∏ô‡∏¥‡∏ï ‡∏®‡∏£‡∏µ‡∏™‡∏∏‡∏Ç', yearLevel: 3 },
  { id: '6501002', name: '‡∏õ‡∏£‡∏µ‡∏¢‡∏≤ ‡∏á‡∏≤‡∏°‡∏™‡∏∏‡∏Ç', yearLevel: 3 },
  { id: '6401001', name: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏ç ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏£', yearLevel: 4 },
  { id: '6401002', name: '‡∏™‡∏∏‡∏°‡∏≤‡∏•‡∏µ ‡∏â‡∏•‡∏≤‡∏î', yearLevel: 4 }
];

let selectedStudents = [];
let currentObservations = [];

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  loadObservations();
});

function loadObservations() {
  currentObservations = [...mockObservations];
  renderObservations();
}

function renderObservations() {
  const container = document.getElementById('observationsList');
  
  if (currentObservations.length === 0) {
    container.innerHTML = `
      <div style="padding:40px;text-align:center;color:var(--color-muted)">
        <div style="font-size:3rem;margin-bottom:16px">üìã</div>
        <h3 style="color:var(--color-text)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏</h3>
        <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        <button class="btn btn--primary" onclick="openCreateObservationModal()">
          <span>‚ûï</span>
          ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà
        </button>
      </div>
    `;
    return;
  }

  container.innerHTML = currentObservations.map(obs => `
    <div class="observation-card">
      <div class="observation-header">
        <div>
          <h3 class="observation-title">${obs.name}</h3>
          <div class="observation-meta">
            <span>üìÖ ${formatThaiDate(obs.startDate)} - ${formatThaiDate(obs.endDate)}</span>
            <span>üéì ‡∏õ‡∏µ ${obs.yearLevel}</span>
            <span>üë• ${obs.totalStudents} ‡∏Ñ‡∏ô</span>
          </div>
        </div>
        <span class="status-badge ${obs.status}">
          ${getStatusText(obs.status)}
        </span>
      </div>

      <div class="progress-section">
        <div class="progress-item">
          <div class="progress-number">${obs.completedEvaluations}/${obs.totalStudents}</div>
          <div class="progress-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à</div>
        </div>
        <div class="progress-item">
          <div class="progress-number">${obs.submittedLessonPlans}/${obs.totalStudents}</div>
          <div class="progress-label">‡∏™‡πà‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</div>
        </div>
        <div class="progress-item">
          <div class="progress-number">${Math.round((obs.completedEvaluations / obs.totalStudents) * 100)}%</div>
          <div class="progress-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
        </div>
      </div>

      <div class="observation-actions">
        <button class="btn btn--secondary btn--sm" onclick="manageStudents(${obs.id})">
          üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        </button>
        <button class="btn btn--secondary btn--sm" onclick="viewProgress(${obs.id})">
          üìä ‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
        </button>
        <button class="btn btn--secondary btn--sm" onclick="exportData(${obs.id})">
          üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </button>
        ${obs.status === 'active' ? `
          <button class="btn btn--danger btn--sm" onclick="terminateObservation(${obs.id})">
            üõë ‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏
          </button>
        ` : ''}
      </div>
    </div>
  `).join('');
}

function filterObservations() {
  const academicYear = document.getElementById('academicYearFilter').value;
  const yearLevel = document.getElementById('yearLevelFilter').value;
  const status = document.getElementById('statusFilter').value;

  currentObservations = mockObservations.filter(obs => {
    return (!academicYear || obs.academicYear === academicYear) &&
           (!yearLevel || obs.yearLevel.toString() === yearLevel) &&
           (!status || obs.status === status);
  });

  renderObservations();
}

function openCreateObservationModal() {
  document.getElementById('createObservationModal').style.display = 'flex';
  loadStudentsForSelection();
}

function closeCreateObservationModal() {
  document.getElementById('createObservationModal').style.display = 'none';
  document.getElementById('createObservationForm').reset();
  selectedStudents = [];
}

function checkYearConflict() {
  const academicYear = document.getElementById('academicYear').value;
  const yearLevel = document.getElementById('yearLevel').value;
  const warning = document.getElementById('yearConflictWarning');

  if (academicYear && yearLevel) {
    const conflict = mockObservations.some(obs => 
      obs.academicYear === academicYear && obs.yearLevel.toString() === yearLevel
    );
    
    warning.style.display = conflict ? 'block' : 'none';
  } else {
    warning.style.display = 'none';
  }
}

function calculateEndDate() {
  const startDate = document.getElementById('startDate').value;
  if (startDate) {
    const start = new Date(startDate);
    const end = new Date(start.getTime() + (14 * 24 * 60 * 60 * 1000)); // 15 days
    document.getElementById('endDate').value = end.toISOString().split('T')[0];
  }
}

function loadStudentsForSelection() {
  const container = document.getElementById('studentsList');
  container.innerHTML = mockStudents.map(student => `
    <div class="student-item">
      <input type="checkbox" class="student-checkbox" value="${student.id}" 
             onchange="toggleStudentSelection('${student.id}')">
      <div class="student-info">
        <div class="student-name">${student.name}</div>
        <div class="student-id">‡∏£‡∏´‡∏±‡∏™: ${student.id} | ‡∏õ‡∏µ ${student.yearLevel}</div>
      </div>
    </div>
  `).join('');
}

function searchStudents() {
  const query = document.getElementById('studentSearch').value.toLowerCase();
  const items = document.querySelectorAll('.student-item');
  
  items.forEach(item => {
    const text = item.textContent.toLowerCase();
    item.style.display = text.includes(query) ? 'flex' : 'none';
  });
}

function selectAllStudents() {
  const checkboxes = document.querySelectorAll('.student-checkbox');
  const allSelected = Array.from(checkboxes).every(cb => cb.checked);
  
  checkboxes.forEach(cb => {
    cb.checked = !allSelected;
    toggleStudentSelection(cb.value);
  });
}

function toggleStudentSelection(studentId) {
  const checkbox = document.querySelector(`input[value="${studentId}"]`);
  if (checkbox.checked) {
    if (!selectedStudents.includes(studentId)) {
      selectedStudents.push(studentId);
    }
  } else {
    selectedStudents = selectedStudents.filter(id => id !== studentId);
  }
}

function manageStudents(observationId) {
  const observation = mockObservations.find(obs => obs.id === observationId);
  if (!observation) return;

  document.getElementById('managementModalTitle').textContent = `‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ - ${observation.name}`;
  
  const content = `
    <div class="students-management">
      <div style="margin-bottom:16px;">
        <input type="text" class="form-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤..." onkeyup="searchManagedStudents(this.value)">
      </div>
      
      <div class="managed-students-list">
        ${observation.students.map(student => `
          <div class="managed-student-item" style="display:flex;align-items:center;gap:16px;padding:16px;border:1px solid var(--color-border);border-radius:8px;margin-bottom:12px;">
            <div style="flex:1;">
              <div style="font-weight:500;color:var(--color-text);">${student.name}</div>
              <div style="font-size:0.85rem;color:var(--color-muted);margin:4px 0;">‡∏£‡∏´‡∏±‡∏™: ${student.id}</div>
              <div style="display:flex;gap:16px;font-size:0.8rem;">
                <span>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: ${student.evaluationsCompleted}/9</span>
                <span>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô: ${student.lessonPlanSubmitted ? '‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á'}</span>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <span class="status-badge ${student.status}" style="text-align:center;">
                ${student.status === 'active' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ù‡∏∂‡∏Å' : '‡∏¢‡∏∏‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß'}
              </span>
              ${student.status === 'active' ? `
                <button class="btn btn--danger btn--sm" onclick="terminateStudent('${student.id}', ${observationId})">
                  ‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å
                </button>
              ` : `
                <button class="btn btn--secondary btn--sm" onclick="reactivateStudent('${student.id}', ${observationId})">
                  ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà
                </button>
              `}
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;

  document.getElementById('studentManagementContent').innerHTML = content;
  document.getElementById('studentManagementModal').style.display = 'flex';
}

function closeStudentManagementModal() {
  document.getElementById('studentManagementModal').style.display = 'none';
}

function terminateStudent(studentId, observationId) {
  Swal.fire({
    icon: 'warning',
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å',
    text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
    showCancelButton: true,
    confirmButtonText: '‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#d33'
  }).then((result) => {
    if (result.isConfirmed) {
      // Update mock data
      const observation = mockObservations.find(obs => obs.id === observationId);
      const student = observation.students.find(s => s.id === studentId);
      if (student) {
        student.status = 'terminated';
      }
      
      Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
      manageStudents(observationId); // Refresh
    }
  });
}

function reactivateStudent(studentId, observationId) {
  // Update mock data
  const observation = mockObservations.find(obs => obs.id === observationId);
  const student = observation.students.find(s => s.id === studentId);
  if (student) {
    student.status = 'active';
  }
  
  Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
  manageStudents(observationId); // Refresh
}

function viewProgress(observationId) {
  // Implementation for viewing detailed progress
  Swal.fire('Coming Soon', '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'info');
}

function exportData(observationId) {
  // Implementation for exporting data
  Swal.fire('Coming Soon', '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'info');
}

function terminateObservation(observationId) {
  Swal.fire({
    icon: 'warning',
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏',
    text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
    showCancelButton: true,
    confirmButtonText: '‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#d33'
  }).then((result) => {
    if (result.isConfirmed) {
      const observation = mockObservations.find(obs => obs.id === observationId);
      if (observation) {
        observation.status = 'cancelled';
      }
      
      Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏¢‡∏∏‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
      renderObservations();
    }
  });
}

// Form submission
document.getElementById('createObservationForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = {
    name: document.getElementById('observationName').value,
    academicYear: document.getElementById('academicYear').value,
    yearLevel: parseInt(document.getElementById('yearLevel').value),
    startDate: document.getElementById('startDate').value,
    endDate: document.getElementById('endDate').value,
    description: document.getElementById('description').value,
    students: selectedStudents
  };

  // Check for conflicts
  const conflict = mockObservations.some(obs => 
    obs.academicYear === formData.academicYear && obs.yearLevel === formData.yearLevel
  );
  
  if (conflict) {
    Swal.fire({
      icon: 'error',
      title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ',
      text: '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß'
    });
    return;
  }

  if (selectedStudents.length === 0) {
    Swal.fire({
      icon: 'warning',
      title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
      text: '‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô'
    });
    return;
  }

  // Create new observation (mock)
  const newObservation = {
    id: Date.now(),
    ...formData,
    status: 'active',
    totalStudents: selectedStudents.length,
    completedEvaluations: 0,
    submittedLessonPlans: 0,
    students: selectedStudents.map(id => {
      const student = mockStudents.find(s => s.id === id);
      return {
        id: student.id,
        name: student.name,
        status: 'active',
        evaluationsCompleted: 0,
        lessonPlanSubmitted: false
      };
    })
  };

  mockObservations.push(newObservation);
  
  Swal.fire({
    icon: 'success',
    title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    text: `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${selectedStudents.length} ‡∏Ñ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`
  });

  closeCreateObservationModal();
  loadObservations();
});

// Helper functions
function formatThaiDate(dateStr) {
  const d = new Date(dateStr);
  const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
  return `${d.getDate()} ${thaiMonths[d.getMonth()]} ${d.getFullYear() + 543}`;
}

function getStatusText(status) {
  const statusMap = {
    active: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
    completed: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
    cancelled: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
  };
  return statusMap[status] || status;
}

function searchManagedStudents(query) {
  const items = document.querySelectorAll('.managed-student-item');
  items.forEach(item => {
    const text = item.textContent.toLowerCase();
    item.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
  });
}

// Close modals when clicking outside
document.getElementById('createObservationModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeCreateObservationModal();
  }
});

document.getElementById('studentManagementModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeStudentManagementModal();
  }
});
</script>